<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			rel="icon"
			type="image/x-icon"
			href="https://static.playoverwatch.com/img/favicon-696bc07714.ico"
		/>
		<script
			src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.0/dist/alpine.min.js"
			defer
		></script>
		<script>
			const i18n = {
				en: {
					title: "Who is bothering you?",
					pick: "then pick...",
					dontPick: "and <strong>don't</strong> pick...",
					modalTitle: hero =>
						`<strong>${hero}</strong> is bothering you?`
				},
				es: {
					title: "Qui√©n te est√° jodiendo?",
					pick: "entonces eleg√≠...",
					dontPick: "y <strong>no</strong> elijas...",
					modalTitle: hero =>
						`<strong>${hero}</strong> te est√° jodiendo?`
				}
			};
			const lang = navigator.language.startsWith("es") ? "es" : "en";
		</script>
		<script>
			const init = () =>
				fetch("./data.json")
					.then(response => response.json())
					.then(data =>
						data.map(({ name, strong, ...rest }) => ({
							...rest,
							name,
							strong: [...strong].sort(),
							weak: data
								.filter(({ strong }) => strong.includes(name))
								.map(({ name }) => name)
								.sort()
						}))
					);
		</script>
		<link rel="stylesheet" href="./style.css" />
		<title>ANNOWYING</title>
	</head>
	<body>
		<header x-data>
			<h1 x-text="i18n[lang].title"></h1>
		</header>
		<section
			x-data="{heroes:[],selectedHero:{}}"
			x-init="init().then(data=>heroes=data)"
		>
			<template x-for="hero in heroes" x-bind:key="hero">
				<button
					class="hero"
					x-bind:style="`background-image: url(${hero.image})`"
					x-bind:title="hero.name"
					x-on:click="$refs.dialog.showModal();selectedHero=hero"
				></button>
			</template>
			<dialog x-ref="dialog">
				<h1 x-html="i18n[lang].modalTitle(selectedHero.name)"></h1>
				<button
					class="close"
					x-on:click="$refs.dialog.close();selectedHero={}"
				>
					&times;
				</button>
				<template x-if="selectedHero?.weak?.length">
					<details open>
						<summary x-text="i18n[lang].pick"></summary>
						<section class="weak">
							<template
								x-for="hero in selectedHero.weak"
								x-bind:key="hero"
							>
								<img
									x-bind:src="heroes.find(({ name }) => name === hero).image"
									x-bind:alt="hero"
								/>
							</template>
						</section>
					</details>
				</template>
				<template x-if="selectedHero?.strong?.length">
					<details open>
						<summary x-html="i18n[lang].dontPick"></summary>
						<section class="strong">
							<template
								x-for="hero in selectedHero.strong"
								x-bind:key="hero"
							>
								<img
									x-bind:src="heroes.find(({ name }) => name === hero).image"
									x-bind:alt="hero"
								/>
							</template>
						</section>
					</details>
				</template>
				<template
					x-if="!selectedHero?.weak?.length && !selectedHero?.strong?.length"
				>
					<header>
						<h1>ü§∑</h1>
					</header>
				</template>
			</dialog>
		</section>
	</body>
</html>
